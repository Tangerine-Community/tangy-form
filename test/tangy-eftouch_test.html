<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <title>tangy-eftouch test</title>
    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/redux/dist/redux.js"></script>
    <script src="../node_modules/wct-browser-legacy/browser.js"></script>
  </head>
  <body>

    <test-fixture id="EFTouchFixture">
      <template>
        <tangy-eftouch name="animal_selection" label="Which is your favorite animal?">
            <option width=30 height=50 src="assets/images/bird.png" value="bird"></option>
            <option width=30 height=50 src="assets/images/cat.png" value="cat"></option>
            <option width=30 height=50 src="assets/images/cow.png" value="cow"></option>
            <option width=30 height=50 src="assets/images/dog.png" value="dog"></option>
            <option width=30 height=50 src="assets/images/fish.png" value="fish"></option>
            <option width=30 height=50 src="assets/images/pig.png" value="pig"></option>
          </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="UnusualLayoutFixture">
      <template>
          <tangy-eftouch name="cat_selection" label="Which is your favorite cat?">

            <option width=10 height=50 src="assets/images/bird.png" value="orange">Orange</option>
            <option width=70 height=50 src="assets/images/cat.png" value="banana">Banana</option>
            <option width=10 height=50 src="assets/images/cat.png" value="tangerine">Tangerine</option>

            <option width=80 height=50 src="assets/images/cat.png" value="cantalope">Cantalope</option>
            <option width=5 height=50 src="assets/images/cat.png" value="cherry">Cherry</option>
            <option width=5 height=50 src="assets/images/cat.png" value="kiwi">Kiwi</option>

          </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="FixedLayoutFixture">
      <template>
          <tangy-eftouch width=100 height=100 name="cat_selection" label="Which is your favorite cat?">

            <option width=10 height=50 src="assets/images/bird.png" value="orange">Orange</option>
            <option width=70 height=50 src="assets/images/cat.png" value="banana">Banana</option>
            <option width=10 height=50 src="assets/images/cat.png" value="tangerine">Tangerine</option>

            <option width=80 height=50 src="assets/images/cat.png" value="cantalope">Cantalope</option>
            <option width=5 height=50 src="assets/images/cat.png" value="cherry">Cherry</option>
            <option width=5 height=50 src="assets/images/cat.png" value="kiwi">Kiwi</option>

          </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchAutoProgressFixture">
      <template>
        <tangy-eftouch auto-progress value="fruit_selection" label="What is your favorite fruit?">
          <option value="orange" src="assets/images/cat.png"></option>
          <option value="banana" src="assets/images/cat.png"></option>
          <option value="tangerine" src="assets/images/cat.png"></option>
          <option value="cantalope" src="assets/images/cat.png"></option>
          <option value="cherry" src="assets/images/cat.png"></option>
          <option value="kiwi" src="assets/images/cat.png"></option>
        </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchImagesFixture">
      <template>
        <tangy-eftouch auto-progress value="fruit_selection" label="What is your favorite fruit?">
          <option value="orange" src="assets/images/cat.png"></option>
          <option value="banana" src="assets/images/cat.png"></option>
          <option value="tangerine" src="assets/images/cat.png"></option>
          <option value="cantalope" src="assets/images/cat.png"></option>
          <option value="cherry" src="assets/images/cat.png"></option>
          <option value="kiwi" src="assets/images/cat.png"></option>
        </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchTransitionFixture">
      <template>
        <tangy-eftouch 
          input-sound="assets/sounds/pop.mp3" 
          transition-sound="assets/sounds/swish.mp3"
          transition-delay=100 
          transition-message="You are being transerred to the next item."
          auto-progress
          name="fruit_selection"
          label="What is your favorite fruit?"
          >
          <option value="orange" src="assets/images/cat.png"></option>
          <option value="banana" src="assets/images/cat.png"></option>
          <option value="tangerine" src="assets/images/cat.png"></option>
          <option value="cantalope" src="assets/images/cat.png"></option>
          <option value="cherry" src="assets/images/cat.png"></option>
          <option value="kiwi" src="assets/images/cat.png"></option>
        </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchWarningFixture">
      <template>
        <tangy-eftouch warning-time=100 warning-message="You are running out of time!" value="fruit_selection" label="What is your favorite fruit?">
          <option value="orange" src="assets/images/cat.png"></option>
          <option value="banana" src="assets/images/cat.png"></option>
          <option value="tangerine" src="assets/images/cat.png"></option>
          <option value="cantalope" src="assets/images/cat.png"></option>
          <option value="cherry" src="assets/images/cat.png"></option>
          <option value="kiwi" src="assets/images/cat.png"></option>
        </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchTimeLimitFixture">
      <template>
        <tangy-eftouch time-limit=100 value="fruit_selection" label="What is your favorite fruit?">
          <option value="orange" src="assets/images/cat.png"></option>
          <option value="banana" src="assets/images/cat.png"></option>
          <option value="tangerine" src="assets/images/cat.png"></option>
          <option value="cantalope" src="assets/images/cat.png"></option>
          <option value="cherry" src="assets/images/cat.png"></option>
          <option value="kiwi" src="assets/images/cat.png"></option>
        </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchMultiSelectFixture">
      <template>
        <tangy-eftouch name="fruit_selection" multi-select label="What is your favorite fruit?">
          <option width=30 height=50 value="orange" src="assets/images/cat.png"></option>
          <option width=30 height=50 value="banana" src="assets/images/cat.png"></option>
          <option width=30 height=50 value="tangerine" src="assets/images/cat.png"></option>
          <option width=30 height=50 value="cantalope" src="assets/images/cat.png"></option>
          <option width=30 height=50 value="cherry" src="assets/images/cat.png"></option>
          <option width=30 height=50 value="kiwi" src="assets/images/cat.png"></option>
        </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchCorrectFixture">
      <template>
        <tangy-eftouch incorrect-message="You chose the wrong option. Try again." name="fruit_selection" label="What is your favorite fruit?">
          <option value="orange" correct src="assets/images/cat.png"></option>
          <option value="banana" correct src="assets/images/cat.png"></option>
          <option value="tangerine" src="assets/images/cat.png"></option>
          <option value="cantalope" src="assets/images/cat.png"></option>
          <option value="cherry" src="assets/images/cat.png"></option>
          <option value="kiwi" src="assets/images/cat.png"></option>
        </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchWithCorrectFixture">
      <template>
        <tangy-eftouch 
          name="animal_selection" 
          label="Which animal can breath under water?"
          incorrect-message="You chose the wrong option. Try again."
          transition-message="Great job!"
          transition-delay="1000"
          >
            <option width=30 height=50 src="assets/images/bird.png" value="bird"></option>
            <option width=30 height=50 src="assets/images/cat.png" value="cat"></option>
            <option width=30 height=50 src="assets/images/cow.png" value="cow"></option>
            <option width=30 height=50 src="assets/images/dog.png" value="dog"></option>
            <option width=30 height=50 src="assets/images/fish.png" value="fish" correct></option>
            <option width=30 height=50 src="assets/images/pig.png" value="pig"></option>
          </tangy-eftouch>
      </template>
    </test-fixture>

    <test-fixture id="EFTouchWithMultipleCorrectFixture">
      <template>
        <tangy-eftouch multi-select name="animal_selection" label="Which animals can not breath under water?">
            <option width=30 height=50 src="assets/images/cow.png" value="cow" correct></option>
            <option width=30 height=50 src="assets/images/dog.png" value="dog" correct></option>
            <option width=30 height=50 src="assets/images/fish.png" value="fish"></option>
          </tangy-eftouch>
      </template>
    </test-fixture>

    <script type="module">
      import * as Polymer from '../node_modules/@polymer/polymer/polymer-legacy.js'
      import '../input/tangy-eftouch.js'

      suite('tangy-eftouch', () => {

        test('should have a default width of the width of the screen', () => { 
          const element = fixture('UnusualLayoutFixture')
          assert.equal(element.offsetWidth, document.documentElement.offsetWidth)
        })

        test('should have a set width', () => { 
          const element = fixture('FixedLayoutFixture')
          assert.equal(element.offsetWidth, 100)
        })

        test('should have a default height', () => { 
          const element = fixture('UnusualLayoutFixture')
          assert.equal(element.offsetHeight, 400)
        })

        test('should have a set height', () => { 
          const element = fixture('FixedLayoutFixture')
          assert.equal(element.offsetHeight, 100)
        })

        test('should have value and highlight after selection', () => { 
          const element = fixture('EFTouchFixture');
          // @TODO Should be 'orange'. There is a bug deeper down causing radio button labels to be names.
          element.shadowRoot.querySelector('img').click()
          assert.equal(element.value.selection, 'bird')
          assert.equal(element.value.startTime !== 0, true)
          assert.equal(element.value.selectionTime !== 0, true)
        })

        test('should auto-progress after selection', () => {
          const element = fixture('EFTouchAutoProgressFixture');
          let eventDidFire = false
          element.addEventListener('next', _ => {
            eventDidFire = true
          })
          element.shadowRoot.querySelector('img').click()
          assert.equal(eventDidFire, true)
        });

        test('should show images for options', () => { 
          const element = fixture('EFTouchImagesFixture')
          assert(element.shadowRoot.querySelectorAll('img').length, 6)
        })

        test('should give warning message after hitting warning time', (done) => { 
          const element = fixture('EFTouchWarningFixture')
          setTimeout(() => {
            assert.equal(element.hasAttribute('warning-triggered'), true)
            done()
          }, 100)
        });

        test('should transition with delay, message, and sound', (done) => { 
          const element = fixture('EFTouchTransitionFixture')
          let eventDidFire = false
          element.addEventListener('next', () => {
            eventDidFire = true
          })
          element.shadowRoot.querySelector('img').click()
          setTimeout(() => {
            assert.equal(eventDidFire, true)
            done()
          }, 101)
          assert.equal(eventDidFire, false)
          assert.equal(element.hasAttribute('transition-triggered'), true)
        });
        
        test('should transition at time limit', (done) => { 
          const element = fixture('EFTouchTimeLimitFixture')
          let eventDidFire = false
          element.addEventListener('next', () => {
            eventDidFire = true
          })
          setTimeout(() => {
            assert.equal(eventDidFire, true)
            done()
          }, 101)
          assert.equal(eventDidFire, false)
        });

        test('should allow multi-select', () => { 
          const element = fixture('EFTouchMultiSelectFixture');
          element.shadowRoot.querySelectorAll('img')[0].click()
          element.shadowRoot.querySelectorAll('img')[4].click()
          assert(element.shadowRoot.querySelectorAll('[selected]').length, 2)
          assert(element.value.selection.length, 2)
        });

        test('should have value of correctness', () => { 
          const element = fixture('EFTouchWithCorrectFixture');
          element.shadowRoot.querySelectorAll('img')[0].click()
          assert.equal(element.value.correct, false)
          element.shadowRoot.querySelectorAll('img')[4].click()
          assert.equal(element.value.correct, true)
        });

        test('should have value of correctness with multi-select', () => { 
          const element = fixture('EFTouchWithMultipleCorrectFixture');
          element.shadowRoot.querySelectorAll('img')[0].click()
          assert.equal(element.value.correct, false)
          element.shadowRoot.querySelectorAll('img')[1].click()
          assert.equal(element.value.correct, true)
        });
        
        test('should not allow proceeding without correct selection when required (auto progress and manual)')
        test('should show transition message but not auto progress')
        test('should not allow correction (important in training, not demonstrating)')
        test('should not allow proceeding without selection when required (auto progress and manual)')
        test('should proceed after correction')
        test('should not show warning message if a selection is made')
        test('when incorrect option selected, should instruct to provide correction and highlight correct option and not proceed until corrected')
        test('should instruct to provide correction and not show correct or incorrect options')
        test('should be able to skip given correctness of prior entry in a set of items')
        test('can group questions to be able to calculate % correct in a group')
        test('should leave fullscreen after 5 times pressing x button');
        test('should resume')
        test('should disable')

      })

    </script>

  </body>
</html>
